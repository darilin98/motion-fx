# Dev Journal Entry 07

### Brief work description

During this milestone I've finally started writing the theoretical part of the thesis. Alongside it, I've been 
gathering related articles and reading. 

Regarding the plugin itself, I also:

- Fixed crashes due to race conditions (hanging detached threads)
- Discovered a major flaw in the current state of the plugin (and already drafted a solid plan for a fix)

The major flaw mentioned is that actually exporting a track with the plugin does not work.

To my understanding, during export the DAW only calls `process()` without the controller at an accelerated pace. 
Right now the modulation is completely disjointed from the actual track time.

My proposed solution would be to create a vector of modulation (per video timestamp) which would be saved inside the 
processor. It could then only fallback when its not receiving inputParamChanges (which happens during export, the 
plugin currently just keeps whatever value was last, which leads me to assume that the controller is not at all 
present). But my current model is still very much useful for a live-preview. Thus the plugin will have 2 hidden modes:

#### Plugin Modes (Most likely only internal)

##### Preview

- live video reacting to track
- not synced to audio time
- builds a vector of modulations for the
- play/pause saves timestamp but it does not get used
    - inputParamChanges keep coming in so no need for fallback

- also needed for live instrument playing (without necessarily exporting the result)

##### Bouncing (Export)

- no inputParamChanges coming in -> we fall back to our vector of changes
- if playing at start -> videoTime = trackTime
- if paused at start -> nothing, waiting for automation to switch param Playing to 1
    - we register the change from automation in inputParamChanges, setup timings and start outputting based on video
    - if looping is 1 then we repeat

Play/Pause/Loop needs to signal back to the controller too -> to react with the preview accordingly

### Future plans

- Introduce saved modulation vector for exporting without controller
- Playback controls
- Submit thesis specification

### Estimated time spent

|  **Project Task**   | **Time spent** |
|:-------------------:|:--------------:|
| Architecture design |    3 hours     |
| Race condition fix  |    2 hours     |
|   Reading/Writing   |    10 hours    |
